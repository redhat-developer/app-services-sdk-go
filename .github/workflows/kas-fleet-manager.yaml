name: Build KAS Fleet Manager API
on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review, edited]

jobs:
  kas_fleet_manager:
    env: 
      BF2_TOKEN: ${{ secrets.BF2_TOKEN }}
      GITHUB_REPO: "bf2fc6cc711aee1a0c2a/kas-fleet-manager"
      OPENAPI_FILE: "kas-fleet-manager.yaml"

    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: |
          curl -s https://${{ env.BF2_TOKEN }}@raw.githubusercontent.com/${{ env.GITHUB_REPO }}/main/openapi/${{ env.OPENAPI_FILE }} -o ${{ env.OPENAPI_FILE }}
      - uses: craicoverflow/openapi-generator-generate-action@v1
        with:
          generator: go
          input: ${{ env.OPENAPI_FILE }}
          output: apis/kafka/kasfleetmanager/v1
          git-user-id: "${{ github.org }}"
          git-repo-id: "${{ github.repository }}/apis/kafka/kasfleetmanager/v1"
          additional-properties: "isGoSubModule=true"
      - run: rm -rf kas-fleet-manager.yaml
      - uses: peter-evans/create-pull-request@v3
        with:
          title: "[WIP] chore(kasfleetmanager): re-generate API clientUpdate API client"
          token: "${{ secrets.CI_USER_TOKEN }}"
          commit-message: "chore(kasfleetmanager): re-generate API client"
          base: "setup"

          draft: true

